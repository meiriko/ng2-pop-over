{"version":3,"file":"pop-over.component.js","sourceRoot":"","sources":["../src/pop-over.component.ts"],"names":[],"mappings":"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","sourcesContent":["import { Component, OnDestroy, Input, ViewChild, AfterViewInit, Renderer2 } from '@angular/core';\nimport { Observable, Subscription, BehaviorSubject } from 'rxjs/Rx';\n\n@Component({\n    selector: 'pop-over',\n    styles: [\n        `.pop-over-content {\n            position: absolute;\n            transition: opacity 0.2s ease-in-out;\n            background: #FFFFFF;\n            z-index: 1060;\n        }`\n    ],\n    template: `<div class=\"pop-over\">\n        <div #popOverContent class=\"pop-over-content\" [ngClass]=\"contentClass\"\n             [class.shown]=\"visible$ | async\">\n            <ng-content *ngIf=\"visible$ | async\"></ng-content>\n        </div>\n    </div>`\n})\nexport class PopOverComponent implements OnDestroy, AfterViewInit {\n    private showOnSubscription: Subscription;\n    private hideOnSubscription: Subscription;\n    private originalParent: Node;\n    private clickSubscription: Subscription;\n\n    @Input('show-on')\n    set showOn(value: Observable<MouseEvent>){\n        this.showOnSubscription && this.showOnSubscription.unsubscribe();\n        value && (this.showOnSubscription = value.subscribe(this.show.bind(this)));\n    };\n\n    @Input('hide-on')\n    set hideOn(value: Observable<MouseEvent>){\n        this.hideOnSubscription && this.hideOnSubscription.unsubscribe();\n        value && (this.hideOnSubscription = value.subscribe(this.hide.bind(this)));\n    };\n    @Input('keep-on-click-outside') keepOnClickOutside: boolean;\n    @Input('anchor-to') anchorTo: boolean|Node = false;\n    @Input() my: string;\n    @Input() at: string;\n    @Input('x-offset') xOffset: number = 0;\n    @Input('y-offset') yOffset: number = 0;\n    @Input('content-class') contentClass: string;\n    @ViewChild('popOverContent') content: any;\n\n    visible$: BehaviorSubject<boolean> = new BehaviorSubject<boolean>(false);\n\n    constructor(private renderer: Renderer2) { }\n\n    ngOnDestroy() {\n        this.hideOnSubscription && this.hideOnSubscription.unsubscribe();\n        this.showOnSubscription && this.showOnSubscription.unsubscribe();\n    }\n\n    ngAfterViewInit(): any {\n        this.renderer.setStyle(this.content.nativeElement, 'opacity', '0');\n        this.renderer.setStyle(this.content.nativeElement, 'visibility', 'hidden');\n        return undefined;\n    }\n\n    private isPosition(parts: Array<string>, type: string): boolean {\n        return parts.indexOf(type) >= 0;\n    }\n\n    private computeAtPosition(target: any, position: string, xOffset: number = 0, yOffset: number = 0): [number, number] {\n        let x: number;\n        let y: number;\n\n        let positionParts = (position || '').split(/\\s+/);\n        if (positionParts.length > 2) {\n            console.warn('bad position: ', position);\n        }\n\n        let targetPosition = target.getBoundingClientRect();\n        if (this.isPosition(positionParts, 'left')) {\n            x = targetPosition.left - xOffset;\n        } else if (this.isPosition(positionParts, 'right')) {\n            x = targetPosition.right + xOffset;\n        } else {\n            x = (targetPosition.left + targetPosition.right) / 2;\n        }\n\n        if (this.isPosition(positionParts, 'top')) {\n            y = targetPosition.top - yOffset;\n        } else if (this.isPosition(positionParts, 'bottom')) {\n            y = targetPosition.bottom + yOffset;\n        } else {\n            y = (targetPosition.top + targetPosition.bottom) / 2;\n        }\n\n        return [x, y];\n    }\n\n    private computePosition(el: any, event: MouseEvent): [number, number] {\n        let baseX: number;\n        let baseY: number;\n        let boundryMargin: number = 5;\n        let bodyPosition = el.ownerDocument.body.getClientRects()[0];\n\n        if (this.anchorTo) {\n            let target: any = (this.anchorTo instanceof Node ? this.anchorTo: event.target);\n            [baseX, baseY] = this.computeAtPosition(target, this.at);\n        } else {\n            [baseX, baseY] = [event.clientX, event.clientY];\n        }\n\n        let [offsetX, offsetY] = this.computeAtPosition(el,\n            (this.my) || '', this.xOffset, this.yOffset);\n        let elPosition = el.getBoundingClientRect();\n        let pagePosition = el.ownerDocument.body.getBoundingClientRect();\n        let documentElement = el.ownerDocument.documentElement;\n        offsetX = offsetX - elPosition.left + pagePosition.left;\n        offsetY = offsetY - elPosition.top + pagePosition.top;\n        return [\n            Math.max(boundryMargin - bodyPosition.left, Math.min(\n                baseX - offsetX,\n                documentElement.clientWidth - bodyPosition.left - elPosition.width - boundryMargin)),\n            Math.max(boundryMargin - bodyPosition.top, Math.min(\n                baseY - offsetY,\n                documentElement.clientHeight - bodyPosition.top - elPosition.height - boundryMargin))\n        ];\n    }\n\n    hide() {\n        this.renderer.setStyle(this.content.nativeElement, 'opacity', '0');\n        this.renderer.setStyle(this.content.nativeElement, 'visibility', 'hidden');\n        this.visible$.next(false);\n        this.originalParent && this.originalParent.appendChild(this.content.nativeElement);\n    }\n\n    show(event: MouseEvent) {\n        this.clickSubscription && this.clickSubscription.unsubscribe();\n        this.visible$.next(true);\n        let el = this.content.nativeElement;\n        this.originalParent = el.parentNode;\n        el.ownerDocument.body.appendChild(el);\n        this.renderer.setStyle(this.content.nativeElement, 'visibility', 'inherit');\n        Observable.timer(0).take(1).subscribe(() => {\n            var [x, y] = this.computePosition(el, event);\n            this.renderer.setStyle(el, 'top', y + 'px');\n            this.renderer.setStyle(el, 'left', x + 'px');\n            this.renderer.setStyle(el, 'opacity', '1');\n            if (!this.keepOnClickOutside) {\n                this.clickSubscription = Observable.fromEvent(el.ownerDocument, 'click')\n                    .skipUntil(Observable.timer(0))\n                    .filter((md: MouseEvent) => !el.contains(md.target))\n                    .take(1)\n                    .subscribe((v) => (this.hide()))\n            }\n        });\n    }\n\n    toggle(event: MouseEvent) {\n        this.visible$\n            .take(1)\n            .subscribe((visible: boolean) => (visible ? this.hide() : this.show(event)));\n    }\n}\n"]}